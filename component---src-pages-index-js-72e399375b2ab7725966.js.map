{"version":3,"sources":["webpack:///./src/store/maskProvider.js","webpack:///./src/components/markerGroup.js","webpack:///./src/components/map.js","webpack:///./src/components/list.js","webpack:///./src/components/sidebar.js","webpack:///./src/store/provider.js","webpack:///./src/pages/index.js"],"names":["MaskProvider","createContext","children","allMaskdataJson","filter","useContext","FilterProvider","geoJson","nodes","useState","store","setStore","all","length","adult","item","properties","mask_adult","mask_child","Provider","value","map","useLeaflet","window","iconUrl","source","allFile","getIconUrl","shadow","orange","red","green","disableClusteringAtZoom","GeoJSON","key","data","pointToLayer","feature","latlng","total","L","marker","icon","createIcon","shadowUrl","onEachFeature","layer","bindPopup","popup","init","lat","lng","mapRef","useRef","setVisibleData","bounds","_southWest","_northEast","visibleData","features","geometry","coordinates","getBounds","handleMoveEnd","e","target","useEffect","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","current","leafletElement","flyTo","LatLng","useMemo","Container","zoom","zoomControl","maxZoom","minZoom","center","onmoveend","ref","ZoomControl","WMSTileLayer","attribution","url","styled","Map","text","TextProvider","num","setNum","list","forEach","name","indexOf","push","id","loadMoreButton","Button","onClick","prev","slice","div","toggle","setToggle","theme","Toggle","props","button","IndexPage","title"],"mappings":"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","file":"component---src-pages-index-js-72e399375b2ab7725966.js","sourcesContent":["import React, { createContext, useState, useContext } from \"react\";\nimport { useStaticQuery, graphql } from \"gatsby\";\nimport { FilterProvider } from \"./filterProvider\";\n\nexport const MaskProvider = createContext();\n\nexport default ({ children }) => {\n  const { allMaskdataJson } = useStaticQuery(graphql`\n    {\n      allMaskdataJson {\n        nodes {\n          type\n          features {\n            type\n            properties {\n              address\n              available\n              mask_adult\n              mask_child\n              name\n              note\n              phone\n              updated\n              id\n            }\n            geometry {\n              coordinates\n              type\n            }\n          }\n        }\n      }\n    }\n  `);\n\n  const { filter } = useContext(FilterProvider);\n\n  const [geoJson] = allMaskdataJson.nodes;\n\n  let [store, setStore] = useState([]);\n\n  if (!filter.all && store.length > 0) {\n    if (filter.adult) {\n      store = store.filter(item => item.properties.mask_adult > 0);\n    } else {\n      store = store.filter(item => item.properties.mask_child > 0);\n    }\n  }\n\n  return (\n    <MaskProvider.Provider value={{ store, setStore, geoJson }}>\n      {children}\n    </MaskProvider.Provider>\n  );\n};\n","import React, { useContext } from \"react\";\nimport { MaskProvider } from \"../store/maskProvider\";\nimport { useStaticQuery, graphql } from \"gatsby\";\nimport { useLeaflet, GeoJSON } from \"react-leaflet\";\nimport MarkerClusterGroup from \"react-leaflet-markercluster\";\nimport L from \"leaflet\";\nimport { createIcon, getIconUrl } from \"./icon\";\nimport \"react-leaflet-markercluster/dist/styles.min.css\";\nimport { popup } from \"./popup\";\nimport \"../style/popup.css\";\n\nexport default () => {\n  const { map } = useLeaflet();\n  window.map = map;\n\n  const {\n    allFile: { nodes: source }\n  } = useStaticQuery(graphql`\n    {\n      allFile(filter: { name: { regex: \"/marker/\" } }) {\n        nodes {\n          name\n          publicURL\n        }\n      }\n    }\n  `);\n\n  const { shadow, orange, red, green } = getIconUrl(source);\n\n  const { geoJson } = useContext(MaskProvider);\n  let iconUrl;\n\n  const createCustomIcon = (feature, latlng) => {\n    const { mask_adult, mask_child } = feature.properties;\n\n    const total = mask_adult + mask_child;\n\n    if (total >= 100) {\n      iconUrl = orange;\n    } else {\n      iconUrl = red;\n    }\n\n    if (total === 0) {\n      iconUrl = green;\n    }\n\n    return L.marker(latlng, {\n      icon: createIcon({\n        iconUrl,\n        shadowUrl: shadow\n      })\n    });\n  };\n\n  const onEachFeature = (feature, layer) => {\n    layer.bindPopup(popup(feature.properties));\n  };\n\n  return (\n    <MarkerClusterGroup disableClusteringAtZoom={17}>\n      <GeoJSON\n        key=\"geoJson\"\n        data={geoJson}\n        pointToLayer={createCustomIcon}\n        onEachFeature={onEachFeature}\n      />\n    </MarkerClusterGroup>\n  );\n};\n","import React, { useContext, useEffect, useRef, useMemo } from \"react\";\nimport { Map, ZoomControl, WMSTileLayer } from \"react-leaflet\";\nimport styled from \"styled-components\";\nimport { MaskProvider } from \"../store/maskProvider\";\nimport MarkerGroup from \"./markerGroup\";\nimport L from \"leaflet\";\n\nconst init = {\n  lat: 25.045655,\n  lng: 121.536456\n};\n\nconst getBounds = (geoJson, _southWest, _northEast) => {\n  return geoJson.features.filter(item => {\n    const [lng, lat] = item.geometry.coordinates;\n\n    return (\n      lat > _southWest.lat &&\n      lng > _southWest.lng &&\n      lat < _northEast.lat &&\n      lng < _northEast.lng\n    );\n  });\n};\n\nexport default () => {\n  const { setStore, geoJson } = useContext(MaskProvider);\n  const mapRef = useRef();\n\n  const setVisibleData = bounds => {\n    const { _southWest, _northEast } = bounds;\n\n    const visibleData = getBounds(geoJson, _southWest, _northEast);\n\n    setStore(visibleData);\n  };\n\n  const handleMoveEnd = e => {\n    setVisibleData(e.target.getBounds());\n  };\n\n  useEffect(() => {\n    navigator.geolocation.getCurrentPosition(position => {\n      const { latitude, longitude } = position.coords;\n\n      mapRef.current.leafletElement.flyTo(new L.LatLng(latitude, longitude));\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    setVisibleData(mapRef.current.leafletElement.getBounds());\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return useMemo(\n    () => (\n      <Container\n        zoom={16}\n        zoomControl={false}\n        maxZoom={18}\n        minZoom={10}\n        center={init}\n        onmoveend={handleMoveEnd}\n        ref={mapRef}\n      >\n        <ZoomControl position=\"topright\" />\n        <WMSTileLayer\n          attribution={`Map data <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors Sam`}\n          url=\"https://wmts.nlsc.gov.tw/wmts/EMAP/default/EPSG:3857/{z}/{y}/{x}\"\n        />\n\n        <MarkerGroup />\n      </Container>\n    ),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n};\n\nconst Container = styled(Map)`\n  height: 100vh;\n  z-index: 0;\n  transition: width 0.5s;\n`;\n","import React, { useContext, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { MaskProvider } from \"../store/maskProvider\";\nimport { TextProvider } from \"../store/textProvider\";\n\nimport Block from \"./block\";\n\nexport default () => {\n  const { store } = useContext(MaskProvider);\n  const { text } = useContext(TextProvider);\n  const [num, setNum] = useState(9);\n  let list = [];\n\n  const handleLoad = () => {\n    if (store.length > 10) setNum(prev => prev + 10);\n  };\n\n  store.forEach(item => {\n    if (item.properties.name.indexOf(text) === -1) {\n      return;\n    }\n\n    const [lng, lat] = item.geometry.coordinates;\n\n    list.push(\n      <Block\n        properties={item.properties}\n        coordinates={[lat, lng]}\n        key={item.properties.id}\n      />\n    );\n  });\n\n  const loadMoreButton =\n    num + 1 < list.length ? (\n      <Button onClick={handleLoad}>載入更多</Button>\n    ) : null;\n\n  return (\n    <Container>\n      {list.slice(0, num)}\n      {loadMoreButton}\n    </Container>\n  );\n};\n\nconst Container = styled.div`\n  width: 100%;\n  height: calc(100vh - 136px - 124px);\n  background: #ffffff 0% 0% no-repeat padding-box;\n  overflow: auto;\n\n  &::-webkit-scrollbar-thumb {\n    border-radius: 10px;\n    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\n    background-color: #cccccc;\n  }\n\n  &::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n    background-color: #f5f5f5;\n  }\n\n  &::-webkit-scrollbar-track {\n    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\n    border-radius: 10px;\n    background-color: #fff;\n  }\n`;\n\nconst Button = styled.div`\n  width: 100px;\n  height: 50px;\n  margin: auto;\n  line-height: 50px;\n  text-align: center;\n  cursor: pointer;\n`;\n","import React, { useState } from \"react\";\nimport styled, { ThemeProvider } from \"styled-components\";\n\nimport Info from \"./info\";\nimport Search from \"./search\";\nimport List from \"./list\";\nimport TextProvider from \"../store/textProvider\";\n\nexport default () => {\n  const [toggle, setToggle] = useState(true);\n\n  const handleToggle = () => setToggle(prev => !prev);\n\n  return (\n    <ThemeProvider theme={{ toggle }}>\n      <Container>\n        <Info />\n        <TextProvider>\n          <Search />\n          <List />\n        </TextProvider>\n        <Toggle onClick={handleToggle}></Toggle>\n      </Container>\n    </ThemeProvider>\n  );\n};\n\nconst Container = styled.div`\n  @media (min-width: 360px) {\n    height: 100vh;\n    width: 315px;\n    -webkit-box-shadow: 5px 0px 15px -8px rgba(0, 0, 0, 0.77);\n    -moz-box-shadow: 5px 0px 15px -8px rgba(0, 0, 0, 0.77);\n    box-shadow: 5px 0px 15px -8px rgba(0, 0, 0, 0.77);\n    z-index: 1;\n    background: #ffffff 0% 0% no-repeat padding-box;\n    display: grid;\n    grid-template-rows: 136px 124px auto;\n    transform: ${props =>\n      props.theme.toggle ? \"translateX(-100%)\" : \"translateX(0)\"};\n    position: fixed;\n    transition: transform 0.5s;\n  }\n\n  @media (min-width: 768px) {\n    position: relative;\n    transform: translateX(0);\n  }\n`;\n\nconst Toggle = styled.button`\n  position: absolute;\n  width: 25px;\n  height: 50px;\n  right: -25px;\n  top: 10vh;\n  cursor: pointer;\n  background: rgba(255, 255, 255, 0.9)\n    url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAUCAQAAAAXDMSnAAAAi0lEQVR4AX3JQcqBURQG4O/+9WNG30D3vOfSDTuQsgcZyBakZANSzMVMBme3zsBI5/VMn4ZKLP5ki1E4tYejWpilxVUtzOEUD68odYmXR5BJNp/4zllXD2phllYvamHmirsayUkfJ5ruHzueTldC08kcT5YOY9xYujqQM03XKXuaLmEtNF1e1Nz89gbL+0do6OEwRwAAAABJRU5ErkJggg==)\n    7px center/7px 10px no-repeat;\n  box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.3);\n  z-index: -1;\n  transform: ${props => props.theme.toggle && \"scaleX(-1)\"};\n  outline: none;\n  border: 0;\n  border-left: 1px solid #d4d4d4;\n\n  @media (min-width: 768px) {\n    display: none;\n  }\n`;\n","import React from \"react\";\nimport MaskProvider from \"./maskProvider\";\nimport FilterProvider from \"./filterProvider\";\n\nexport default ({ children }) => {\n  return (\n    <FilterProvider>\n      <MaskProvider>{children}</MaskProvider>\n    </FilterProvider>\n  );\n};\n","import React from \"react\";\n\nimport Seo from \"../components/seo\";\nimport Map from \"../components/map\";\nimport Sidebar from \"../components/sidebar\";\nimport Provider from \"../store/provider\";\nimport Layout from \"../components/layout\";\n\nconst IndexPage = () => {\n  return (\n    <Layout>\n      <Provider>\n        <Seo title=\"Mask map\" />\n        <Sidebar />\n        <Map />\n      </Provider>\n    </Layout>\n  );\n};\n\nexport default IndexPage;\n"],"sourceRoot":""}